<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Data Dashboard</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h2>MQTT Data</h2>
    <table>
        <thead>
            <tr>
                <th>Ch1 kW</th>
                <th>Ch2 kW</th>
                <th>Ch3 kW</th>
                <th>Chp1 kW</th>
                <th>Chp2 kW</th>
                <th>Chp3 kW</th>
                <th>Cdp1 kW</th>
                <th>Cdp2 kW</th>
                <th>Cdp3 kW</th>
                <th>Ct1 kW</th>
                <th>Ct2 kW</th>
                <th>Ct3 kW</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="Ch1_kw">-</td>
                <td id="Ch2_kw">-</td>
                <td id="Ch3_kw">-</td>
                <td id="Chp1_kw">-</td>
                <td id="Chp2_kw">-</td>
                <td id="Chp3_kw">-</td>
                <td id="Cdp1_kw">-</td>
                <td id="Cdp2_kw">-</td>
                <td id="Cdp3_kw">-</td>
                <td id="Ct1_kw">-</td>
                <td id="Ct2_kw">-</td>
                <td id="Ct3_kw">-</td>
            </tr>
        </tbody>
    </table>

    <h2>Speed of VSD</h2>
    <table>
        <thead>
            <tr>
                <th>VSD Speed</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="VSD_Speed">-</td>
            </tr>
        </tbody>
    </table>


    <script>
        const socket = io("https://vav-qsncc.onrender.com", {
            transports: ["websocket", "polling"]
        });

        // ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        socket.on("connect", () => {
            console.log("‚úÖ WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Socket ID:", socket.id);
        });

        socket.on("connect_error", (error) => {
            console.error("‚ùå WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        });

        // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ WebSocket ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        socket.onAny((event, data) => {
            console.log(`üì° Event: ${event}`, data);
        });

        // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô HTML ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö MQTT Data
        socket.on("mqttData", (data) => {
            console.log("üì° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å WebSocket:", data);

            Object.keys(data).forEach((key) => {
                let id = key.replace(/\./g, "_"); // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ Key ‡∏ó‡∏µ‡πà‡∏°‡∏µ "." ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô "_"
                let value = parseFloat(data[key]).toFixed(2);

                let element = document.getElementById(id);
                if (element) {
                    element.innerText = value;
                } else {
                    console.warn(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Element ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${key}`);
                }

                // üö® ‡∏ñ‡πâ‡∏≤ VSD Speed = 0 ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                if (key === "VSD_Speed" && parseFloat(value) === 0) {
                    alert("üö® Alarm! VSD Speed is 0! üö®");
                }
            });
        });

    </script>
</body>
</html>
