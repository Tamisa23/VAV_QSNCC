<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Data Dashboard</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }

         /* ‚úÖ Alarm Message Style */
         #alarmBox {
            display: none;
            background-color: rgb(240, 163, 163);
            color: white;
            text-align: center;
            padding: 10px;
            font-size: 18px;
            font-weight: bold;
        }

        /* ‚úÖ Effect: Blinking (‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö JavaScript) */
        .blinking {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
      
    
    <h2>MQTT Data</h2>
    <table>
        <thead>
            <tr>
                <th>Ch1 kW</th>
                <th>Ch2 kW</th>
                <th>Ch3 kW</th>
                <th>Chp1 kW</th>
                <th>Chp2 kW</th>
                <th>Chp3 kW</th>
                <th>Cdp1 kW</th>
                <th>Cdp2 kW</th>
                <th>Cdp3 kW</th>
                <th>Ct1 kW</th>
                <th>Ct2 kW</th>
                <th>Ct3 kW</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="Ch1_kw">-</td>
                <td id="Ch2_kw">-</td>
                <td id="Ch3_kw">-</td>
                <td id="Chp1_kw">-</td>
                <td id="Chp2_kw">-</td>
                <td id="Chp3_kw">-</td>
                <td id="Cdp1_kw">-</td>
                <td id="Cdp2_kw">-</td>
                <td id="Cdp3_kw">-</td>
                <td id="Ct1_kw">-</td>
                <td id="Ct2_kw">-</td>
                <td id="Ct3_kw">-</td>
            </tr>
        </tbody>
    </table>

    <h2>Speed of VSD</h2>
    <table>
        <thead>
            <tr>
                <th>VSD Speed</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="VSD_Speed">-</td>
            </tr>
        </tbody>
    </table>
    <footer> <!-- ‚úÖ Alarm Message -->
        <h3> <div id="alarmBox">üö® Alarm! VSD Speed is 0! üö®</div> </h3>
         </footer>

    <script>
        const socket = io("https://vav-qsncc.onrender.com", {
            transports: ["websocket", "polling"]
        });

        // ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        socket.on("connect", () => {
            console.log("‚úÖ WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Socket ID:", socket.id);
        });

        socket.on("connect_error", (error) => {
            console.error("‚ùå WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        });

        // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ WebSocket ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        socket.onAny((event, data) => {
            console.log(`üì° Event: ${event}`, data);
        });

        // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô HTML ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö MQTT Data
        socket.on("mqttData", (data) => {
            console.log("üì° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å WebSocket:", data);

            Object.keys(data).forEach((key) => {
                let id = key.replace(/\./g, "_"); // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ Key ‡∏ó‡∏µ‡πà‡∏°‡∏µ "." ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô "_"
                let value = parseFloat(data[key]).toFixed(2);

                let element = document.getElementById(id);
                if (element) {
                    element.innerText = value;
                } else {
                    console.warn(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Element ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${key}`);
                }

        if (key === "VSD_Speed") {
                    let alarmBox = document.getElementById("alarmBox");
                    if (parseFloat(value) === 0) {
                        alarmBox.style.display = "block";  // üö® ‡πÅ‡∏™‡∏î‡∏á Alarm
                        alarmBox.classList.add("blinking"); // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° effect ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
                    } else {
                        alarmBox.style.display = "none";   // ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô Alarm
                        alarmBox.classList.remove("blinking"); // ‚úÖ ‡∏´‡∏¢‡∏∏‡∏î effect ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
                    }
                }
            });
        });
    </script>
</body>
</html>